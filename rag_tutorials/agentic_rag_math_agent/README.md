# 🧠 数学辅导智能体（Math Tutor Agent）—— 带反馈循环的智能体驱动型检索增强生成（Agentic RAG）

本项目采用**智能体驱动型检索增强生成（Agentic-RAG）架构**，模拟数学教授的角色，可针对**JEE（印度工程教育入学考试）级别的数学题目**提供分步解析。系统能智能地在向量数据库与网页搜索之间路由查询请求，应用输入 / 输出防护机制，并融入人工反馈以实现持续学习。

## 📌 功能特点

* ✅ **输入防护机制（基于 DSPy 框架）**：仅接收学术类数学问题，过滤无关请求。

* 📚 **知识库检索**：采用**Qdrant 向量数据库**结合 OpenAI 嵌入技术，实现已知题目的匹配查询。

* 🌐 **网页搜索 fallback（备用方案）**：当未找到匹配度较高的题目时，集成**Tavily API**进行网页搜索补充。

* ✍️ **GPT-4.1 分步解析**：生成数学题目的详细解题步骤与解释。

* 🛡️ **输出防护机制**：对输出内容进行正确性与安全性过滤，避免错误信息。

* 👍 **人工参与反馈循环（Human-in-the-Loop）**：用户可对答案进行评分（是 / 否），评分数据用于系统后续优化。

* 📊 **基准测试**：基于**JEEBench 数据集**进行性能评估，支持调整题目数量上限。

* 💻 **Streamlit 用户界面**：交互式仪表盘，包含多个功能标签页，操作直观。

## 🚀 架构流程

![2025年5月4日下午3点45分58秒截图](https://github.com/user-attachments/assets/c0a9e612-2ef0-413c-b779-c99fe9f48619)

## 📚 知识库

* **数据集来源**：[JEEBench 数据集（HuggingFace 平台）](https://huggingface.co/datasets/daman1209arora/jeebench)

* **向量数据库**：Qdrant（搭配 OpenAI 嵌入模型生成向量）

* **存储方案**：基于`llama-index`框架构建，用于持久化存储向量数据，并支持 Top-1 相似度检索（即返回匹配度最高的 1 条结果）。

## 🌐 网页搜索

* 当知识库中未找到匹配度较高的题目时，自动触发**Tavily API**进行网页搜索。

* 搜索获取的内容将传入**GPT-4o 模型**，生成简洁规范的解题解析。

## 🔐 防护机制

* **输入防护（基于 DSPy 框架）**：仅允许与数学相关的学术类问题进入系统，拦截无关请求（如闲聊、其他学科问题）。

* **输出防护（基于 DSPy 框架）**：过滤存在幻觉信息（如虚假公式、错误推导）或偏离数学主题的输出内容，确保解析的准确性与相关性。

## 👨‍🏫 人工参与反馈循环

* 通过 Streamlit 用户界面，学生在查看答案后可点击👍（认可）或👎（不认可）给出反馈。

* 反馈数据将记录到本地 JSON 文件中，用于后续优化模型的解题能力（如调整检索策略、补充知识库内容）。

## 📊 基准测试

* 测试数据集：**50 道随机抽取的 JEEBench 数学题**

* **当前准确率**：66%

* 测试结果存储路径：`benchmark/results.csv`（包含题目、模型解析、正确答案、准确率等数据）

## 🚀 演示运行

通过以下命令使用 Streamlit 启动应用：

```
streamlit run app/streamlit.py
```

