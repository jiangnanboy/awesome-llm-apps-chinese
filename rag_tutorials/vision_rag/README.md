# 基于 Cohere Embed-4 的视觉 RAG 系统 🖼️

这是一个功能强大的视觉检索增强生成（RAG）系统，它利用 Cohere 最先进的 Embed-4 模型进行多模态嵌入，并借助谷歌高效的 Gemini 2.5 Flash 模型来回答有关图像和 PDF 页面的问题。

## 功能特点

* **多模态搜索**：利用 Cohere Embed-4 找到与给定文本问题在语义上最相关的图像（或 PDF 页面图像）。

* **视觉问答**：采用谷歌 Gemini 2.5 Flash 分析检索到的图像 / 页面内容，生成准确、贴合上下文的答案。

* **灵活的内容来源**：

  * 使用预加载的金融图表和信息图样本。

  * 上传自定义图像（PNG、JPG、JPEG 格式）。

  * **上传 PDF 文档**：自动将页面提取为图像进行分析。

* **无需 OCR**：直接处理复杂图像和 PDF 页面中的视觉元素，无需单独的文本提取步骤。

* **交互式界面**：基于 Streamlit 构建，方便进行内容加载、问题输入和结果展示操作。

* **会话管理**：在会话中记住已加载 / 上传的内容（图像和处理过的 PDF 页面）。

## 运行要求

* Python 3.8 及以上版本

* Cohere API 密钥

* 谷歌 Gemini API 密钥

## 运行方法

按照以下步骤设置并运行应用程序：

1. **克隆仓库并导航到目录**：

```
git clone https://github.com/Shubhamsaboo/awesome-llm-apps.git

cd awesome-llm-apps/rag\_tutorials/vision\_rag
```

2. **安装依赖包**：

```
pip install -r requirements.txt
```

（确保已安装最新版本的`PyMuPDF`以及其他所需依赖）

3. **设置 API 密钥**：

* 从[https://dashboard.cohere.com/api-keys](https://dashboard.cohere.com/api-keys)获取 Cohere API 密钥

* 从[https://aistudio.google.com/app/apikey](https://aistudio.google.com/app/apikey)获取谷歌 API 密钥

4. **运行 Streamlit 应用**：

```
streamlit run vision\_rag.py
```

5. **访问 Web 界面**：

* Streamlit 会在终端中提供一个本地 URL（通常是`http://localhost:8501`）

* 在 Web 浏览器中打开该 URL

## 工作原理

该应用程序遵循两阶段 RAG 流程：

1. **检索阶段**：

* 当加载样本图像或上传自己的图像 / PDF 时：


  * 普通图像会转换为 base64 字符串

  * **PDF 会逐页处理**：每一页都被渲染为图像，临时保存并转换为 base64 字符串

* 使用 Cohere 的`embed-v4.0`模型（设置`input_type="search_document"`）为每个图像或 PDF 页面图像生成密集向量嵌入

* 当提问时，使用相同的`embed-v4.0`模型（设置`input_type="search_query"`）对文本查询进行嵌入处理

* 计算问题嵌入与所有图像嵌入之间的余弦相似度

* 具有最高相似度分数的图像（可能是普通图像或特定 PDF 页面图像）被检索为最相关的上下文

2. **生成阶段**：

* 将原始文本问题和检索到的图像 / 页面图像作为输入传递给谷歌`gemini-2.5-flash-preview-04-17`模型

* Gemini 结合问题上下文分析图像内容，并生成文本答案

## 使用方法

1. 在侧边栏中输入 Cohere 和谷歌 API 密钥

2. 加载内容：

* 点击 \*\*"加载样本图像"\*\* 下载并处理内置示例

* 或者 / 并且使用 \*\*"上传您的图像或 PDF"\*\* 部分上传自己的图像或 PDF 文件

3. 内容加载和处理（生成嵌入）完成后，\*\*"提问"\*\* 部分将被启用

4. （可选）展开 \*\*"查看已加载图像"\*\*，查看当前会话中所有图像和处理过的 PDF 页面的缩略图

5. 在文本输入框中输入关于已加载内容的问题

6. 点击 \*\*"运行视觉 RAG"\*\*

7. 查看结果：

* 被判定为与问题最相关的**检索到的图像 / 页面**（说明文字会标注来源 PDF 和页码，如适用）

* Gemini 基于图像和问题生成的**答案**

## 应用场景

* 分析金融图表并提取关键数据或趋势

* 回答关于图像或 PDF 中的图表、流程图或信息图的特定问题

* 从截图或 PDF 页面中的表格或文本提取信息，无需显式 OCR

* 使用自然语言构建和查询视觉知识库（基于图像和 PDF）

* 理解各种复杂视觉文档的内容，包括多页报告

## 注意事项

* 图像和 PDF 处理（页面渲染 + 嵌入）可能需要时间，尤其是对于大量内容或大文件。样本图像在首次加载后会被缓存；目前 PDF 处理在会话中每次上传时都会进行。

* 确保您的 API 密钥具有使用所涉及的 Cohere 和 Gemini 模型所需的权限和配额。

* 答案质量取决于检索到的图像的相关性以及 Gemini 模型根据问题解读图像的能力。
